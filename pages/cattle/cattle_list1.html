<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
    />
    <title></title>

    <link rel="stylesheet" href="../../assets/css/style.css" />
    <link rel="stylesheet" href="../../assets/css/cattles/cattlelist.css" />
    <link rel="stylesheet" href="../../assets/css/headerFooter.css" />
    <link
      rel="icon"
      href="../../assets/images/cattles/logo1.png"
      type="image/x-icon"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=PT+Serif:ital,wght@0,400;0,700;1,700&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <main>
      <!-- Cattles Section  -->

      <!-- <div class="filter_cattles_container">
          <div class="filter_container">
            <div class="breed_filter_container">
              <div class="topic_container">
                <p class="topic">Breeds</p>
              </div>
              <div class="breed_list_container"></div>
            </div>

            <div class="breed_filter_container">
              <div class="topic_container">
                <p class="topic">Districts</p>
              </div>
              <div class="state_list_container"></div>
            </div>

            <div class="range_container">
              <div class="topic_container">
                <p class="topic">Price <small>(INR)</small></p>
              </div>
              <div class="wrapper">
                <div class="price-input">
                  <div class="field">
                    <input
                      type="number"
                      class="input-min"
                      min="1000"
                      max="300000"
                      value="1000"
                    />
                  </div>
                  <div class="field_separator">to</div>
                  <div class="field">
                    <input
                      type="number"
                      class="input-max"
                      min="1000"
                      max="300000"
                      value="300000"
                    />
                  </div>
                </div>
                <div class="slider">
                  <div class="progress"></div>
                </div>
                <div class="range-input">
                  <input
                    type="range"
                    class="range-min"
                    min="1000"
                    max="300000"
                    value="1000"
                    step="500"
                  />
                  <input
                    type="range"
                    class="range-max"
                    min="1000"
                    max="300000"
                    value="300000"
                    step="500"
                  />
                </div>
              </div>
            </div>

            <div class="pincode_container">
              <div class="topic_container">
                <p class="topic">Pincode</p>
              </div>
              <div class="search_bar_container">
                <input
                  type="search"
                  placeholder="search"
                  oninput="this.value = this.value.replace(/[^0-9]/g,'')"
                  minlength="6"
                  maxlength="6"
                  id="pincode_input"
                />
                <i class="fa-solid fa-magnifying-glass" id="mag_search"></i>
              </div>
            </div>
          </div>
        </div> -->

      <div class="px-5 py-4">
        <div class="d-flex justify-content-between align-items-center">
          <h2 class="title"></h2>
          <span class="badge badge_outline">Total: 4</span>
        </div>
        <div class="cattles_container"></div>
      </div>
    </main>

    <script src="../../assets/js/main.js"></script>
    <script src="../../assets/js/header.js"></script>
    <script src="../../assets/js/footer.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
      integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
      crossorigin="anonymous"
    ></script>

    <script>
      const breed_list = [
        {
          name: "Gir",
          category: "Cow",
        },
        {
          name: "Red sindhi",
          category: "Cow",
        },
        {
          name: "Kankrej",
          category: "Cow",
        },
        {
          name: "Jersey",
          category: "Cow",
        },
        {
          name: "Rathi Heifer",
          category: "Cow",
        },
        {
          name: "Kapila",
          category: "Cow",
        },
        {
          name: "Vilwadri",
          category: "Cow",
        },
        {
          name: "HF",
          category: "Cow",
        },
        {
          name: "Tharparkar",
          category: "Cow",
        },
        {
          name: "Sahiwal",
          category: "Cow",
        },
        {
          name: "Deoni",
          category: "Cow",
        },
        {
          name: "Surti",
          category: "Buffalo",
        },
        {
          name: "Nili",
          category: "Buffalo",
        },
        {
          name: "Banni",
          category: "Buffalo",
        },
        {
          name: "Murrah",
          category: "Buffalo",
        },
        {
          name: "Jafarabadi",
          category: "Buffalo",
        },
        {
          name: "Malabari",
          category: "Goat",
        },
        {
          name: "Sirohi",
          category: "Goat",
        },
        {
          name: "Kota",
          category: "Goat",
        },
        {
          name: "Beetal",
          category: "Goat",
        },
        {
          name: "Sannen",
          category: "Goat",
        },
        {
          name: "Jamunapari",
          category: "Goat",
        },
        {
          name: "Boer",
          category: "Goat",
        },
        {
          name: "Sojat",
          category: "Goat",
        },
        {
          name: "Barbari",
          category: "Goat",
        },
        {
          name: "Gujri",
          category: "Goat",
        },
        {
          name: "Jakhrana",
          category: "Goat",
        },
        {
          name: "Bannur",
          category: "Sheep",
        },
        {
          name: "Neelore Jodipi",
          category: "Sheep",
        },
        {
          name: "Sindhanoor",
          category: "Sheep",
        },
        {
          name: "Deccani",
          category: "Sheep",
        },
        {
          name: "Coimbatore",
          category: "Sheep",
        },
        {
          name: "Ongole",
          category: "Ox",
        },
        {
          name: "Brahma",
          category: "Ox",
        },
      ];

      const state_list = [
        { name: "Ariyalur" },
        { name: "Chengalpattu" },
        { name: "Chennai" },
        { name: "Coimbatore" },
        { name: "Cuddalore" },
        { name: "Dharmapuri" },
        { name: "Dindigul" },
        { name: "Erode" },
        { name: "Kallakurichi" },
        { name: "Kanchipuram" },
        { name: "Kanniyakumari" },
        { name: "Karur" },
        { name: "Krishnagiri" },
        { name: "Madurai" },
        { name: "Mayiladuthurai" },
        { name: "Nagapattinam" },
        { name: "Namakkal" },
        { name: "Nilgiris" },
        { name: "Perambalur" },
        { name: "Puducherry" },
        { name: "Pudukkottai" },
        { name: "Ramanathapuram" },
        { name: "Ranipet" },
        { name: "Salem" },
        { name: "Sivaganga" },
        { name: "Tenkasi" },
        { name: "Thanjavur" },
        { name: "Theni" },
        { name: "Thoothukudi" },
        { name: "Tiruchirappalli" },
        { name: "Tirunelveli" },
        { name: "Tirupathur" },
        { name: "Tiruppur" },
        { name: "Tiruvallur" },
        { name: "Tiruvannamalai" },
        { name: "Tiruvarur" },
        { name: "Vellore" },
        { name: "Viluppuram" },
        { name: "Virudhunagar" },
      ];

      const urlParams = new URLSearchParams(window.location.search);
      const cattlePage = urlParams.get("cattleDetails");

      document.querySelector("title").innerText = `${cattlePage
        .slice(0, 1)
        .toUpperCase()}${cattlePage.slice(1)}s Section`;
      document.querySelector("h2.title").innerText = `All ${cattlePage}s`;

      if (VERIFIED_CATTLE_LIST.length !== 0) {
        const cat_breed_list = breed_list.filter(
          (e) => e.category == cattlePage
        );

        // for (let i = 0; i < cat_breed_list.length; i++) {
        //   // breed_container
        //   breed_container = document.createElement("div");
        //   breed_container.setAttribute("class", "breed_container");

        //   // checkbox
        //   checkbox = document.createElement("input");
        //   checkbox.type = "checkbox";
        //   checkbox.setAttribute("class", "checkbox");
        //   checkbox.setAttribute("id", cat_breed_list[i].name);
        //   checkbox.addEventListener("click", breedOnSelect);
        //   breed_container.append(checkbox);

        //   // label
        //   label = document.createElement("label");
        //   label.setAttribute("for", cat_breed_list[i].name);
        //   label.innerText = cat_breed_list[i].name;
        //   breed_container.append(label);

        //   document
        //     .querySelector("div.breed_list_container")
        //     .append(breed_container);
        // }

        // for (let i = 0; i < state_list.length; i++) {
        //   // breed_container
        //   state_container = document.createElement("div");
        //   state_container.setAttribute("class", "state_container");

        //   // checkbox
        //   checkbox = document.createElement("input");
        //   checkbox.type = "checkbox";
        //   checkbox.setAttribute("class", "checkbox1");
        //   checkbox.setAttribute("id", state_list[i].name);
        //   checkbox.addEventListener("click", stateOnSelect);
        //   state_container.append(checkbox);

        //   // label
        //   label = document.createElement("label");
        //   label.setAttribute("for", state_list[i].name);
        //   label.innerText = state_list[i].name;
        //   state_container.append(label);

        //   document
        //     .querySelector("div.state_list_container")
        //     .append(state_container);
        // }

        let cattleDetails = [];

        for (let i = 0; i < VERIFIED_CATTLE_LIST.length; i++) {
          let cattleData = CATTLE_LIST.find(
            (e) =>
              e.cattleUniqueId === VERIFIED_CATTLE_LIST[i]["cattleUniqueId"]
          );
          cattleData.repId = VERIFIED_CATTLE_LIST[i]["repUserId"];
          cattleDetails.push(cattleData);
        }

        let categoryCattleDetails = cattleDetails.filter(
          (e) => e.cattle === cattlePage
        );

        for (let i = 0; i < categoryCattleDetails.length; i++)
          document
            .querySelector("div.cattles_container")
            .append(cards(categoryCattleDetails[i]));

        const selectedBreeds = [];
        const selectedDistricts = [];

        function filterCattles() {
          let breedFilteredCattles = [];

          for (let i = 0; i < selectedBreeds.length; i++) {
            const filter_products = categoryCattleDetails.filter(
              (e) => e.breed === selectedBreeds[i]
            );
            breedFilteredCattles = breedFilteredCattles.concat(filter_products);
          }

          const selectedRep = [];

          for (let i = 0; i < selectedDistricts.length; i++) {
            const filterRep = REP_LIST.find(
              (e) => e.district === selectedDistricts[i]
            );
            if (filterRep) {
              selectedRep.push(filterRep.userId);
            }
          }

          let filteredCattles = [];

          if (selectedBreeds.length > 0 && selectedDistricts.length > 0) {
            const filterCattles = breedFilteredCattles.filter((e) =>
              selectedRep.includes(e.repId)
            );
            filteredCattles = filteredCattles.concat(filterCattles);
          } else if (selectedBreeds.length > 0) {
            filteredCattles = filteredCattles.concat(breedFilteredCattles);
          } else if (selectedDistricts.length > 0) {
            for (let i = 0; i < categoryCattleDetails.length; i++) {
              if (selectedRep.includes(categoryCattleDetails[i].repId))
                filteredCattles.push(categoryCattleDetails[i]);
            }
          } else filteredCattles = categoryCattleDetails;

          displayFilteredCattles(filteredCattles);
        }

        function displayFilteredCattles(cattles) {
          const cattlesContainer = document.querySelector(
            "div.cattles_container"
          );
          cattlesContainer.innerHTML = "";

          if (cattles.length === 0) {
            const no_image = document.createElement("img");
            no_image.setAttribute("src", "../../assets/images/no_result.gif");
            no_image.setAttribute("class", "no_result");
            cattlesContainer.append(no_image);
          } else {
            for (let i = 0; i < cattles.length; i++) {
              const cattle_container = cards(cattles[i]);
              cattlesContainer.append(cattle_container);
            }
          }
        }

        function breedOnSelect(event) {
          const element = event.target;
          if (element.checked) {
            selectedBreeds.push(element.id);
          } else {
            const index = selectedBreeds.indexOf(this.id);
            selectedBreeds.splice(index, 1);
          }
          filterCattles();
        }

        function stateOnSelect(event) {
          const element = event.target;
          if (element.checked) {
            selectedDistricts.push(element.id);
          } else {
            const index = selectedDistricts.indexOf(this.id);
            selectedDistricts.splice(index, 1);
          }
          filterCattles();
        }

        // const magnifying_glass = document.getElementById("mag_search");
        // magnifying_glass.addEventListener("click", function () {
        //   const pincode_value = document.getElementById("pincode_input").value;
        //   const zoneRep = REP_LIST.filter((e) => e.pincode == pincode_value);

        //   const crossButton = document.getElementById("pincode_input");
        //   crossButton.addEventListener("search", () => {
        //     if (!crossButton.value) {
        //       document.querySelector("div.cattles_container").innerHTML = "";
        //       for (let i = 0; i < categoryCattleDetails.length; i++) {
        //         const defaultCattleContainer = cards(categoryCattleDetails[i]);
        //         document
        //           .querySelector("div.cattles_container")
        //           .append(defaultCattleContainer);
        //       }
        //     }
        //   });

        //   if (pincode_value.length === 6) {
        //     document.querySelector("div.cattles_container").innerHTML = "";

        //     const zoneVerifiedCattles = VERIFIED_CATTLE_LIST.filter((e) =>
        //       zoneRep.some((a) => a.userId === e.repUserId)
        //     );
        //     const zoneAllCattles = CATTLE_LIST.filter((e) =>
        //       zoneVerifiedCattles.some(
        //         (a) => a.cattleUniqueId === e.cattleUniqueId
        //       )
        //     );
        //     const zoneCattles = zoneAllCattles.filter(
        //       (e) => e.cattle === cattlePage
        //     );

        //     if (zoneCattles.length == 0) {
        //       const no_image = document.createElement("img");
        //       no_image.setAttribute("src", "../../assets/images/no_result.gif");
        //       no_image.setAttribute("class", "no_result");
        //       document.querySelector("div.cattles_container").append(no_image);
        //     } else {
        //       for (let i = 0; i < zoneCattles.length; i++) {
        //         const cattle_filter_container = cards(zoneCattles[i]);
        //         document
        //           .querySelector("div.cattles_container")
        //           .append(cattle_filter_container);
        //       }
        //     }
        //   } else if (pincode_value.length === 0) {
        //     alert("Please enter a pincode");
        //   } else {
        //     alert("Please enter a proper pincode");
        //   }
        // });

        const rangeInput = document.querySelectorAll(".range-input input");
        const priceInput = document.querySelectorAll(".price-input input");
        const progress = document.querySelector(".slider .progress");

        let priceGap = 2000;
        let uniqueCattles = [];

        priceInput.forEach((input) => {
          input.addEventListener("change", (e) => {
            let minVal = parseInt(priceInput[0].value);
            maxVal = parseInt(priceInput[1].value);

            if (e.target.value < 1000) {
              e.target.value = 1000;
            }

            if (maxVal - minVal >= priceGap && maxVal <= 300000) {
              if (e.target.className === "input-min") {
                rangeInput[0].value = minVal;
                progress.style.left = (minVal / rangeInput[0].max) * 100 + "%";
              } else {
                rangeInput[1].value = maxVal;
                progress.style.right =
                  100 - (maxVal / rangeInput[1].max) * 100 + "%";
              }
            }
            uniqueCattles = [];
            for (let i = 0; i < categoryCattleDetails.length; i++) {
              if (
                minVal < categoryCattleDetails[i]["price"] &&
                categoryCattleDetails[i]["price"] < maxVal
              ) {
                uniqueCattles.push(categoryCattleDetails[i]);
              }
            }
            document.querySelector("div.cattles_container").innerHTML = "";
            if (uniqueCattles.length === 0) {
              const no_image = document.createElement("img");
              no_image.setAttribute("src", "../../assets/images/no_result.gif");
              no_image.setAttribute("class", "no_result");
              document.querySelector("div.cattles_container").append(no_image);
            } else {
              for (let i = 0; i < uniqueCattles.length; i++) {
                const cattle_container = cards(uniqueCattles[i]);
                document
                  .querySelector("div.cattles_container")
                  .append(cattle_container);
              }
            }
          });
        });

        rangeInput.forEach((input) => {
          input.addEventListener("change", (e) => {
            let minVal = parseInt(rangeInput[0].value),
              maxVal = parseInt(rangeInput[1].value);

            if (e.target.value < 1000) {
              e.target.value = 1000;
            }

            if (maxVal - minVal < priceGap) {
              if (e.target.className === "range-min") {
                rangeInput[0].value = maxVal - priceGap;
              } else {
                rangeInput[1].value = minVal + priceGap;
              }
            } else {
              priceInput[0].value = minVal;
              priceInput[1].value = maxVal;
              progress.style.left = (minVal / rangeInput[0].max) * 100 + "%";
              progress.style.right =
                100 - (maxVal / rangeInput[1].max) * 100 + "%";
            }
            uniqueCattles = [];
            for (let i = 0; i < categoryCattleDetails.length; i++) {
              if (
                minVal < categoryCattleDetails[i]["price"] &&
                categoryCattleDetails[i]["price"] < maxVal
              ) {
                uniqueCattles.push(categoryCattleDetails[i]);
              }
            }
            document.querySelector("div.cattles_container").innerHTML = "";
            if (uniqueCattles.length === 0) {
              const no_image = document.createElement("img");
              no_image.setAttribute("src", "../../assets/images/no_result.gif");
              no_image.setAttribute("class", "no_result");
              document.querySelector("div.cattles_container").append(no_image);
            } else {
              for (let i = 0; i < uniqueCattles.length; i++) {
                const cattle_container = cards(uniqueCattles[i]);
                document
                  .querySelector("div.cattles_container")
                  .append(cattle_container);
              }
            }
          });
        });

        function cards(cattle) {
          const card = document.createElement("div");
          card.setAttribute("class", "cattle_card");

          const cardImage = document.createElement("div");
          cardImage.setAttribute("class", "card_image");
          card.append(cardImage);

          const image = document.createElement("img");
          image.setAttribute("src", cattle.images[0]);
          image.setAttribute("alt", `${cattle.breed} ${cattle.cattle}`);
          cardImage.append(image);

          const category = document.createElement("span");
          category.setAttribute("class", "badge badge_filled");
          category.innerText = cattle.cattle;
          cardImage.append(category);

          const cardContent = document.createElement("div");
          cardContent.setAttribute("class", "card_content");
          card.append(cardContent);

          const cardHeader = document.createElement("div");
          cardHeader.setAttribute("class", "card_header");
          cardContent.append(cardHeader);

          const cardTitle = document.createElement("h2");
          cardTitle.setAttribute("class", "card_title");
          cardTitle.innerText = `${cattle.breed} ${cattle.cattle} ${cattle.id}`;
          cardHeader.append(cardTitle);

          const badge = document.createElement("span");
          badge.setAttribute("class", "badge badge_outline");
          badge.innerText = cattle.id;
          cardHeader.append(badge);

          const infoList = document.createElement("div");
          infoList.setAttribute("class", "info_list");
          cardContent.append(infoList);

          ["age", "gender"].forEach((e) => {
            const infoItem = document.createElement("div");
            infoItem.setAttribute("class", "info_item");
            infoList.append(infoItem);

            const label = document.createElement("span");
            label.setAttribute("class", "info_value");
            label.innerText = e;
            infoItem.append(label);

            const value = document.createElement("span");
            value.setAttribute("class", "info_value");
            value.innerText = `${cattle[e]} ${e === "age" ? "Year(s)" : ""}`;
            infoItem.append(value);
          });

          const buttonContainer = document.createElement("a");
          buttonContainer.setAttribute(
            "href",
            `../cattle details/cow/C1.html?breed=${cattle.breed}&cattle_id=${cattle.cattleUniqueId}&user_id=${cattle.repId}`
          );
          cardContent.append(buttonContainer);

          const button = document.createElement("button");
          button.setAttribute("class", "view_details");
          button.innerText = "View Details";
          buttonContainer.append(button);

          return card;
        }
      }
    </script>
  </body>
</html>
