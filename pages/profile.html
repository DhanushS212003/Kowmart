<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
    />
    <title>Buyer Profile</title>

    <link rel="stylesheet" href="../assets/css/style.css" />
    <link rel="stylesheet" href="../assets/css/profile.css" />
    <link rel="stylesheet" href="../assets/css/headerFooter.css" />
    <link
      rel="icon"
      href="../assets/images/cattles/logo1.png"
      type="image/x-icon"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=PT+Serif:ital,wght@0,400;0,700;1,700&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <div id="alertPlaceHolder"></div>
    <div id="confirmationBoxPlaceholder"></div>
    <main class="d-flex justify-content-center align-items-center p-3">
      <div class="profile_section">
        <div class="profile_card">
          <div
            class="d-flex flex-column align-items-center p-3 pb-2 row-gap-2 border-bottom"
          >
            <img
              src="../assets/images/profile_logo.png"
              class="avatar_img"
              alt="User Avatar"
            />
            <h6 class="fw-bold mt-1 text-secondary">Dhanush</h6>
          </div>
          <div class="p-3 py-2">
            <a
              class="profile_menu customer_menu"
              href="cattle/cattleList.html?page=sellerCattleList"
            >
              <i class="fa-solid fa-paw"></i>
              <p>Cattle List</p>
            </a>
            <a
              class="profile_menu customer_menu"
              href="cattle/cattleList.html?page=favourites"
            >
              <i class="fa-solid fa-star"></i>
              <p>Favourites</p>
            </a>
            <a
              class="profile_menu rep_menu"
              href="cattle/cattleList.html?page=repCattleList"
            >
              <i class="fa-solid fa-list"></i>
              <p>Cattle List</p>
            </a>
            <a
              class="profile_menu rep_menu"
              href="cattle/cattleList.html?page=verifiedCattles"
            >
              <i class="fa-solid fa-circle-check"></i>
              <p>Verified Cattles</p>
            </a>
            <a
              class="profile_menu rep_menu"
              href="cattle/cattleList.html?page=rejectedCattles"
            >
              <i class="fa-solid fa-circle-xmark"></i>
              <p>Rejected Cattles</p>
            </a>
            <div class="profile_menu" id="logOut">
              <i class="fa-solid fa-right-from-bracket"></i>
              <p>Log Out</p>
            </div>
            <div class="profile_menu customer_menu" id="delete">
              <i class="fa-solid fa-trash-can"></i>
              <p>Delete Account</p>
            </div>
          </div>
        </div>
        <div class="main_content">
          <h5 class="fw-bold text-secondary text-center">Profile</h5>
          <form novalidate>
            <div class="mt-3 mb-4">
              <div class="mt-2">
                <label for="name" class="form-label">Name</label>
                <input
                  id="name"
                  class="form-control"
                  type="text"
                  placeholder="Name"
                  oninput="this.value = this.value.replace(/[^a-z ]/gi,'')"
                  maxlength="30"
                  disabled
                />
                <div class="name_feedback invalid-feedback">
                  Enter your name
                </div>
              </div>
              <div class="mt-2">
                <label for="phone" class="form-label">Phone</label>
                <input
                  id="phone"
                  class="form-control"
                  type="tel"
                  placeholder="Phone No"
                  oninput="this.value = this.value.replace(/[^0-9]/g,'')"
                  maxlength="10"
                  disabled
                />
                <div class="phone_feedback invalid-feedback">
                  Invalid phone number
                </div>
              </div>
              <div class="mt-2">
                <label for="address" class="form-label">Address</label>
                <input
                  id="address"
                  class="form-control"
                  type="text"
                  placeholder="Address"
                  maxlength="200"
                  disabled
                />
                <div class="address_feedback invalid-feedback">
                  Enter your address
                </div>
              </div>
              <div class="mt-2">
                <label for="district" class="form-label">District</label>
                <select class="form-select" id="district" disabled>
                  <option value="select_district">Select District</option>
                  <option value="Ariyalur">Ariyalur</option>
                  <option value="Chengalpattu">Chengalpattu</option>
                  <option value="Chennai">Chennai</option>
                  <option value="Coimbatore">Coimbatore</option>
                  <option value="Cuddalore">Cuddalore</option>
                  <option value="Dharmapuri">Dharmapuri</option>
                  <option value="Dindigul">Dindigul</option>
                  <option value="Erode">Erode</option>
                  <option value="Kallakurichi">Kallakurichi</option>
                  <option value="Kanchipuram">Kanchipuram</option>
                  <option value="Kanniyakumari">Kanniyakumari</option>
                  <option value="Karur">Karur</option>
                  <option value="Krishnagiri">Krishnagiri</option>
                  <option value="Madurai">Madurai</option>
                  <option value="Mayiladuthurai">Mayiladuthurai</option>
                  <option value="Nagapattinam">Nagapattinam</option>
                  <option value="Namakkal">Namakkal</option>
                  <option value="Nilgiris">Nilgiris</option>
                  <option value="Perambalur">Perambalur</option>
                  <option value="Puducherry">Puducherry</option>
                  <option value="Pudukkottai">Pudukkottai</option>
                  <option value="Ramanathapuram">Ramanathapuram</option>
                  <option value="Ranipet">Ranipet</option>
                  <option value="Salem">Salem</option>
                  <option value="Sivaganga">Sivaganga</option>
                  <option value="Tenkasi">Tenkasi</option>
                  <option value="Thanjavur">Thanjavur</option>
                  <option value="Theni">Theni</option>
                  <option value="Thoothukudi">Thoothukudi</option>
                  <option value="Tiruchirappalli">Tiruchirappalli</option>
                  <option value="Tirunelveli">Tirunelveli</option>
                  <option value="Tirupathur">Tirupathur</option>
                  <option value="Tiruppur">Tiruppur</option>
                  <option value="Tiruvallur">Tiruvallur</option>
                  <option value="Tiruvannamalai">Tiruvannamalai</option>
                  <option value="Tiruvarur">Tiruvarur</option>
                  <option value="Vellore">Vellore</option>
                  <option value="Viluppuram">Viluppuram</option>
                  <option value="Virudhunagar">Virudhunagar</option>
                </select>
                <div class="pincode_feedback invalid-feedback">
                  Select district
                </div>
              </div>
              <div class="mt-2">
                <label for="pincode" class="form-label">Pincode</label>
                <input
                  id="pincode"
                  class="form-control"
                  type="text"
                  inputmode="numeric"
                  placeholder="Pincode"
                  oninput="this.value = this.value.replace(/[^0-9]/g,'')"
                  maxlength="6"
                  disabled
                />
                <div class="pincode_feedback invalid-feedback">
                  Invalid pincode
                </div>
              </div>
            </div>
            <div class="d-flex justify-content-between px-5">
              <button type="button" class="secondary_btn px-3" id="edit">
                Edit
              </button>
              <button type="button" class="primary_btn px-3" id="save" disabled>
                Save
              </button>
            </div>
          </form>
        </div>
      </div>
    </main>

    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/header.js"></script>
    <script src="../assets/js/footer.js"></script>
    <script src="../assets/js/confirmationBox.js"></script>
    <script src="../assets/js/alert.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
      integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
      crossorigin="anonymous"
    ></script>

    <script>
      const editableElementsId = [
        "name",
        "address",
        "district",
        "pincode",
        "save",
      ];
      const mapper = {
        user: ["rep_menu", USER_LIST, "phone", PHONE],
        rep: ["customer_menu", REP_LIST, "userId", REP_ID],
      };
      let mappedKeys = null;

      if (PHONE) mappedKeys = mapper.user;
      else if (REP_ID) mappedKeys = mapper.rep;

      document
        .querySelectorAll("." + mappedKeys[0])
        .forEach((e) => (e.style.display = "none"));

      const data = mappedKeys[1].find(
        (e) => e[mappedKeys[2]] === mappedKeys[3]
      );

      function setInputValues() {
        document.getElementById("name").value = data.name;
        document.getElementById("phone").value = data.phone;
        document.getElementById("address").value = data.address;
        document.getElementById("district").value = data.district;
        document.getElementById("pincode").value = data.pincode;
      }

      setInputValues();
      document.getElementById("edit").addEventListener("click", enableInput);
      document.getElementById("save").addEventListener("click", updateProfile);

      if (PHONE) {
        const del = document.querySelector("#delete");
        del.addEventListener("click", deleteaccount);
      }

      document.getElementById("logOut").addEventListener("click", logOut);

      function enableInput() {
        editableElementsId.forEach((id) =>
          document.getElementById(id).removeAttribute("disabled")
        );
      }

      function disableInput() {
        editableElementsId.forEach((id) =>
          document.getElementById(id).setAttribute("disabled", true)
        );
      }

      function updateProfile() {
        let data = null;

        if (PHONE) data = USER_LIST.find((e) => e.phone === PHONE);
        else if (REP_ID) data = REP_LIST.find((e) => e.userId === REP_ID);

        data.name = document.getElementById("name").value.trim();
        data.address = document.getElementById("address").value.trim();
        data.district = document.getElementById("district").value;
        data.pincode = document.getElementById("pincode").value;

        if (PHONE) localStorage.setItem("userData", JSON.stringify(USER_LIST));
        else if (REP_ID)
          localStorage.setItem("repData", JSON.stringify(REP_LIST));

        appendAlert("Profile updated successfully", "success");
        setInputValues();
        disableInput();
      }

      function logOut() {
        localStorage.removeItem(PHONE ? "phone" : "repId");
        document.body.innerHTML = beforeLogin;
        window.location.href = "../../index.html";
      }

      function deleteaccount() {
        appendConfirmationBox({
          title: "Account Deletion",
          message: "Are you sure you want to delete the account?",
          actionBtn: {
            text: "Delete",
            class: "danger_btn",
          },
          cancelBtn: {
            text: "Cancel",
            class: "cancel_btn",
          },
        });

        document.getElementById("actionBtn").addEventListener("click", () => {
          const removedata = USER_LIST.indexOf(data);
          USER_LIST.splice(removedata, 1);
          localStorage.setItem("userData", JSON.stringify(USER_LIST));
          localStorage.removeItem("phone");
          window.location.href = "../index.html";
        });
      }
    </script>
  </body>
</html>
